# =====================================================
# PROJECT: StarNote-like Drawing App + pub.dev Library
# OWNER: ƒ∞lyas Akta≈ü
# TOOLS: Cursor IDE (Implementer) + Claude Opus (Architect)
# =====================================================

# -----------------------------------------------------
# PHASE STATUS (UPDATED: 2025-01-13)
# -----------------------------------------------------
- Phase 0: COMPLETE ‚úÖ (Scaffolding, Architecture)
- Phase 1: COMPLETE ‚úÖ (UI Skeleton)
- Phase 2: IN PROGRESS üîÑ (Drawing Core)
- Phase 3: NOT STARTED (Canvas Integration, Undo/Redo Execution)

Current Branch: feature/phase2-drawing-core
Current Package: packages/drawing_core

# -----------------------------------------------------
# PHASE 2 SPECIFIC RULES (CRITICAL!)
# -----------------------------------------------------

## PACKAGE BOUNDARY
Phase 2 work ONLY in: packages/drawing_core/
DO NOT modify: packages/drawing_ui/ (Phase 1 code)
DO NOT modify: example_app/

## NO FLUTTER IMPORTS
‚ùå FORBIDDEN:
```dart
import 'package:flutter/material.dart';
import 'package:flutter/widgets.dart';
import 'package:flutter/painting.dart';
```

‚úÖ ALLOWED:
```dart
import 'dart:math';
import 'package:equatable/equatable.dart';
import 'package:meta/meta.dart';
```

## COLOR REPRESENTATION
‚ùå WRONG: Color, Colors.black, Color(0xFF000000)
‚úÖ RIGHT: int color = 0xFF000000; // ARGB format

## IMMUTABILITY
All models MUST be immutable:
```dart
// ‚ùå WRONG
class Stroke {
  List<Point> points = []; // mutable!
}

// ‚úÖ RIGHT
class Stroke {
  final List<Point> points; // immutable
  
  Stroke copyWith({List<Point>? points}) {
    return Stroke(points: points ?? this.points);
  }
}
```

# -----------------------------------------------------
# MANDATORY WORKFLOW (EVERY TASK)
# -----------------------------------------------------

## Before Coding
1. Read the task from PHASE2_CURSOR_INSTRUCTIONS.md
2. Confirm understanding
3. Create/switch to correct branch

## During Coding
1. Write implementation code
2. Write test file IMMEDIATELY after
3. Run: flutter analyze (must be 0 errors)
4. Run: flutter test (must pass)

## After Coding
1. List all modified/created files
2. Show test results
3. Propose commit message
4. WAIT for user approval before commit

## Commit Format
```
feat(core): short description

- Detail 1
- Detail 2
- Detail 3
```

# -----------------------------------------------------
# PROJECT DOCUMENTS (PRIORITY ORDER)
# -----------------------------------------------------
1. docs/PHASE2_MASTER_PLAN.md - Phase 2 overview
2. docs/PHASE2_CURSOR_INSTRUCTIONS.md - Step-by-step tasks
3. docs/ARCHITECTURE.md - Package boundaries
4. docs/PERFORMANCE_STRATEGY.md - Performance rules

# -----------------------------------------------------
# FILE SIZE & STRUCTURE RULES
# -----------------------------------------------------
- Single Dart file: MAX 300 lines
- One class per file (generally)
- Test file for EVERY implementation file
- Clear naming: stroke.dart ‚Üí stroke_test.dart

# -----------------------------------------------------
# TESTING RULES (MANDATORY)
# -----------------------------------------------------
Every model/class MUST have tests for:
- Constructor (all parameter combinations)
- copyWith method
- Equality (== and hashCode)
- JSON serialization (toJson/fromJson)
- Edge cases (null, empty, boundaries)

Test file location mirrors source:
```
lib/src/models/stroke.dart
test/models/stroke_test.dart
```

# -----------------------------------------------------
# GIT WORKFLOW
# -----------------------------------------------------
Branch: feature/phase2-drawing-core

After each major step:
```bash
git add .
git commit -m "feat(core): ..."
git push origin feature/phase2-drawing-core
```

After Phase 2 complete:
```bash
git checkout main
git merge feature/phase2-drawing-core
git push origin main
git tag -a v0.2.0-phase2 -m "Phase 2 complete"
git push origin v0.2.0-phase2
```

# -----------------------------------------------------
# FORBIDDEN ACTIONS
# -----------------------------------------------------
- ‚ùå Modifying Phase 1 UI code
- ‚ùå Using Flutter imports in drawing_core
- ‚ùå Skipping tests
- ‚ùå Committing without user approval
- ‚ùå Mutable state in models
- ‚ùå Creating files > 300 lines
- ‚ùå Phase skipping

# -----------------------------------------------------
# COMMUNICATION RULES
# -----------------------------------------------------
After EVERY task, Cursor MUST report:

```
üìÅ Files Created/Modified:
- path/to/file1.dart (created)
- path/to/file2.dart (modified)

üß™ Test Results:
- flutter analyze: ‚úÖ 0 errors
- flutter test: ‚úÖ X tests passed

üìù Suggested Commit:
feat(core): add DrawingPoint model with tests

Ready to commit? (y/n)
```

# -----------------------------------------------------
# QUICK REFERENCE: Phase 2 Steps
# -----------------------------------------------------
‚ñ° Step 1: DrawingPoint model
‚ñ° Step 2: StrokeStyle model
‚ñ° Step 3: Stroke model
‚ñ° Step 4: Layer model
‚ñ° Step 5: Document model
‚ñ° Step 6: DrawingTool + PenTool
‚ñ° Step 7: HighlighterTool + BrushTool
‚ñ° Step 8: Command pattern
‚ñ° Step 9: HistoryManager
‚ñ° Step 10: PathSmoother + Export

See PHASE2_CURSOR_INSTRUCTIONS.md for details.

# -----------------------------------------------------
# FINAL GOAL REMINDER
# -----------------------------------------------------
Phase 2 produces a UI-agnostic, pub.dev quality drawing core.
This is the FOUNDATION of the entire library.
Quality > Speed. Tests are MANDATORY.
